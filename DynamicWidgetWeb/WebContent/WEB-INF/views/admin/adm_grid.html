<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head>

<!-- start: Meta -->
<meta charset="utf-8" />
<title>Bootstrap Test Dashboard by TOP</title>
<meta name="description" content="Bootstrap Metro Dashboard" />
<meta name="author" content="Topkung" />
<meta name="keyword" content="Metro, Metro UI, Dashboard, Bootstrap, Admin, Template, Theme, Responsive, Fluid, Retina" />
<!-- end: Meta -->

<!-- start: Mobile Specific -->
<meta name="viewport" content="width=device-width, initial-scale=1" />
<!-- end: Mobile Specific -->

<!-- start: CSS -->
<link id="bootstrap-style" href="css/bootstrap.min.css" rel="stylesheet" th:href="@{/resources/grid/css/bootstrap.min.css}" />
<link id="bootstrap-style" href="css/bootstrap.min.css" rel="stylesheet" th:href="@{/resources/grid/css/gridstack.css}" />
<!-- <link href="css/bootstrap-responsive.min.css" rel="stylesheet" th:href="@{/resources/bootstrap/css/bootstrap-responsive.min.css}" /> -->
<!-- <link id="base-style" href="css/style.css" rel="stylesheet" th:href="@{/resources/bootstrap/css/style.css}" /> -->
<!-- <link id="base-style-responsive" href="css/style-responsive.css" rel="stylesheet" th:href="@{/resources/bootstrap/css/style-responsive.css}" /> -->
<!-- <link th:href="@{/resources/bootstrap/css/bootstrap.fonts.css}" rel='stylesheet' type='text/css' /> -->
<!-- end: CSS -->


<!-- The HTML5 shim, for IE6-8 support of HTML5 elements -->
<!--[if lt IE 9]>
	  	<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
		<link id="ie-style" href="css/ie.css" rel="stylesheet">
	<![endif]-->

<!--[if IE 9]>
		<link id="ie9style" href="css/ie9.css" rel="stylesheet">
	<![endif]-->

<!-- start: Favicon -->
<link rel="shortcut icon" href="img/favicon.ico" th:href="@{/resources/bootstrap/img/favicon.ico}" />
<!-- end: Favicon -->
<!-- <link href="/resources/css/jquery-ui.css" rel="stylesheet" media="screen" th:href="@{/resources/css/jquery-ui.css}" /> -->
<script src="/resources/js/jquery-2.1.3.js" th:src="@{/resources/js/jquery-2.1.3.js}"></script>
<script src="/resources/js/jquery-ui.js" th:src="@{/resources/js/jquery-ui.js}"></script>
    <style type="text/css">
        .grid-stack {
            background: lightgoldenrodyellow;
        }

        .grid-stack-item-content {
            color: #2c3e50;
            text-align: center;
            background-color: #18bc9c;
        }
    </style>
</head>
<body>
	<!-- start: Header -->
	<div class="navbar">
		<div class="navbar-inner">
			<div class="container-fluid">
				<a class="btn btn-navbar" data-toggle="collapse" data-target=".top-nav.nav-collapse,.sidebar-nav.nav-collapse"> <span class="icon-bar"></span> <span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</a> <a class="brand" href="index.html"><span>Dash Board</span></a>
			</div>
		</div>
	</div>
	<!-- end: Header -->

	<!-- start: Main -->
	<div class="container-fluid-full">
		<div>
			<a class="btn btn-default" id="save-grid" href="#">Save Grid</a> 
			<a class="btn btn-default" id="load-grid" href="#">Load Grid</a> 
			<a class="btn btn-default" id="clear-grid" href="#">Clear Grid</a>
			<a class="btn btn-default" id="add-grid" href="#">Add Widget</a>
		</div>

		<br />

		<div class="grid-stack"></div>

		<hr />

		<textarea id="saved-data" cols="100" rows="20" readonly="readonly"></textarea>


		<script th:inline="javascript">
		//<![CDATA[
        $(function () {
            var options = {
            };
            $('.grid-stack').gridstack(options);
			var counter = 9;
            new function () {
                this.serialized_data = [
                    {id: 1, x: 0, y: 0, width: 2, height: 2},
                    {id: 2, x: 3, y: 1, width: 1, height: 2},
                    {id: 3, x: 4, y: 1, width: 1, height: 1},
                    {id: 4, x: 2, y: 3, width: 3, height: 1},
                    {id: 5, x: 1, y: 4, width: 1, height: 1},
                    {id: 6, x: 1, y: 3, width: 1, height: 1},
                    {id: 7, x: 2, y: 4, width: 1, height: 1},
                    {id: 8, x: 2, y: 5, width: 1, height: 1}
                ];

                this.grid = $('.grid-stack').data('gridstack');

                this.load_grid = function () {
                    this.grid.remove_all();
                    var items = GridStackUI.Utils.sort(this.serialized_data);
                    _.each(items, function (node) {
                        this.grid.add_widget($('<div><div class="grid-stack-item-content" ><button class="remove-me">Delete me</button></div><div/>'),
                            node.id, node.x, node.y, node.width, node.height);
                    }, this);
                }.bind(this);

                this.save_grid = function () {
                    this.serialized_data = _.map($('.grid-stack > .grid-stack-item:visible'), function (el) {
                        el = $(el);
                        var node = el.data('_gridstack_node');
                        return {
							id: node.id,
                            x: node.x,
                            y: node.y,
                            width: node.width,
                            height: node.height
                        };
                    }, this);
                    $('#saved-data').val(JSON.stringify(this.serialized_data, null, '    '));
                }.bind(this);

                this.clear_grid = function () {
                    this.grid.remove_all();
                }.bind(this);
                
                this.add_grid = function(){
                	this.grid.add_widget($('<div><div class="grid-stack-item-content"><button class="remove-me">Delete me</button></div><div/>'),
                            counter++, 0, 0, Math.floor(1 + 3 * Math.random()), Math.floor(1 + 3 * Math.random()), true);
                }.bind(this);

                $('#save-grid').click(this.save_grid);
                $('#load-grid').click(this.load_grid);
                $('#clear-grid').click(this.clear_grid);
                $('#add-grid').click(this.add_grid);
                this.load_grid();
            };
			$(document).on( "click",".remove-me",function(){
				var grid = $('.grid-stack').data('gridstack');
				grid.remove_widget($(this).parents('.grid-stack-item'));
			});
            
        });
        //]]>
    </script>
	</div>
	<!-- Stop: Main -->

	<!-- start: JavaScript-->
	<div th:replace="fragments/inc_javascript :: grid"></div>
	<script th:inline="javascript">
		//<![CDATA[
		$('a#refresh-cache').click(function(e){
			e.preventDefault();
			var refreshUrl = /*[[@{/dashboard/refreshCache}]]*/;
			$.ajax({
				url: refreshUrl,
				method: "GET",
				dataType: "html",
				success: function(data){
// 					alert('Refresh Widget Cache successfully!');
					window.location.reload();
				},
				error: function(xhr){
					alert('Fail to refresh cache');
				}
			});
		});
		//]]>
	</script>
	<!-- end: JavaScript-->


</body>

</html>